# WebLens - Premium Web Intelligence API
# Cloudflare Workers configuration

name = "weblens"
main = "src/index.ts"
compatibility_date = "2025-11-01"
compatibility_flags = ["nodejs_compat"]

# ============================================
# Environment Variables
# ============================================

[vars]
# x402 Facilitator URL (testnet)
FACILITATOR_URL = "https://x402.org/facilitator"
# Default network for payments
NETWORK = "base-sepolia"

# ============================================
# KV Namespace for Caching
# Requirement 3.1: Cache responses using Cloudflare KV
# ============================================

# Create KV namespace: wrangler kv:namespace create "CACHE"
# Then add the id below
[[kv_namespaces]]
binding = "CACHE"
id = "your-kv-namespace-id-here"
preview_id = "your-preview-kv-namespace-id-here"

# ============================================
# KV Namespace for Agent Memory
# Requirement 7.1: Persistent key-value storage for AI agents
# ============================================

# Create KV namespace: wrangler kv:namespace create "MEMORY"
[[kv_namespaces]]
binding = "MEMORY"
id = "your-memory-kv-namespace-id-here"
preview_id = "your-preview-memory-kv-namespace-id-here"

# ============================================
# KV Namespace for URL Monitors
# Requirement 4.1: URL monitoring with webhook notifications
# ============================================

# Create KV namespace: wrangler kv:namespace create "MONITOR"
[[kv_namespaces]]
binding = "MONITOR"
id = "your-monitor-kv-namespace-id-here"
preview_id = "your-preview-monitor-kv-namespace-id-here"

# ============================================
# Durable Objects for Monitor Scheduling
# Requirement 4.3: Scheduled URL checking
# ============================================

[[durable_objects.bindings]]
name = "MONITOR_SCHEDULER"
class_name = "MonitorScheduler"

[[migrations]]
tag = "v1"
new_classes = ["MonitorScheduler"]

# ============================================
# Browser Rendering
# Requirement 1.1: Screenshot capture using Cloudflare Browser Rendering
# Note: Requires paid Workers plan
# ============================================

[browser]
binding = "BROWSER"

# ============================================
# Production Environment
# ============================================

[env.production]
vars = { NETWORK = "base", FACILITATOR_URL = "https://x402.org/facilitator" }

[[env.production.kv_namespaces]]
binding = "CACHE"
id = "your-production-kv-namespace-id-here"

[[env.production.kv_namespaces]]
binding = "MEMORY"
id = "your-production-memory-kv-namespace-id-here"

[[env.production.kv_namespaces]]
binding = "MONITOR"
id = "your-production-monitor-kv-namespace-id-here"

[[env.production.durable_objects.bindings]]
name = "MONITOR_SCHEDULER"
class_name = "MonitorScheduler"

# ============================================
# Secrets (set via wrangler secret put)
# ============================================
# WALLET_ADDRESS - Wallet to receive payments
# ANTHROPIC_API_KEY - For AI-powered extraction (optional)

# ============================================
# Build Configuration
# ============================================

[build]
command = "npm run build"

# ============================================
# Observability
# ============================================

[observability]
enabled = true
