# WebLens - Premium Web Intelligence API
# Cloudflare Workers configuration

name = "weblens-production"
main = "src/index.ts"
compatibility_date = "2025-11-01"
compatibility_flags = ["nodejs_compat"]

# Disable workers.dev subdomain (using custom domain)
workers_dev = false
preview_urls = false

# ============================================
# Custom Domain
# ============================================

[[routes]]
pattern = "api.weblens.dev"
custom_domain = true

# ============================================
# Environment Variables
# ============================================

[vars]
NETWORK = "base-sepolia"
# Public wallet address for receiving payments
PAY_TO_ADDRESS = "0x1369f9899B0Eb899336A196003c86262997e7567"
# Secrets are set via Cloudflare dashboard or `wrangler secret put`
# Do NOT add API keys here â€” they will be committed to version control

# ============================================
# KV Namespace for Caching
# ============================================

# Create KV namespace: wrangler kv:namespace create "CACHE"
# Then add the id below
[[kv_namespaces]]
binding = "CACHE"
id = "4b22a633ea824b80a3ec8003add92d0c"

# ============================================
# KV Namespace for Agent Memory
# ============================================

# Create KV namespace: wrangler kv:namespace create "MEMORY"
[[kv_namespaces]]
binding = "MEMORY"
id = "822c601a204c45b8bfd4f47dea4805a8"

# ============================================
# KV Namespace for URL Monitors
# ============================================

# Create KV namespace: wrangler kv:namespace create "MONITOR"
[[kv_namespaces]]
binding = "MONITOR"
id = "56bc1fc46c3747978227b19d89d38b41"

# ============================================
# KV Namespace for Agent Credits
# ============================================

# Create KV namespace: wrangler kv:namespace create "CREDITS"
[[kv_namespaces]]
binding = "CREDITS"
id = "75fa410e8ee54698b1bcd83b0dce8621"

# ============================================
# Durable Objects for Monitor Scheduling
# ============================================

[[durable_objects.bindings]]
name = "MONITOR_SCHEDULER"
class_name = "MonitorScheduler"

[[migrations]]
tag = "v1"
new_sqlite_classes = ["MonitorScheduler"]

# ============================================
# Browser Rendering
# Note: Requires paid Workers plan
# ============================================

[browser]
binding = "BROWSER"

# ============================================
# Secrets (set via `wrangler secret put` or Cloudflare dashboard)
# ============================================
# The following secrets must be configured:
#
#   wrangler secret put CDP_API_KEY_ID
#   wrangler secret put CDP_API_KEY_SECRET
#   wrangler secret put ANTHROPIC_API_KEY
#   wrangler secret put SERP_API_KEY

# ============================================
# Build Configuration
# ============================================

[build]
command = "npm run build"

# ============================================
# Observability
# ============================================

[observability]
enabled = true

# ============================================
# Testnet Environment (Base Sepolia)
# For testing with fake USDC - no real money!
# Run: wrangler dev --env testnet
# ============================================

[env.testnet]
name = "weblens-testnet"
workers_dev = true

# Testnet KV namespaces (create with: wrangler kv:namespace create "CACHE" --env testnet)
[[env.testnet.kv_namespaces]]
binding = "CACHE"
id = "4b22a633ea824b80a3ec8003add92d0c"

[[env.testnet.kv_namespaces]]
binding = "MEMORY"
id = "822c601a204c45b8bfd4f47dea4805a8"

[[env.testnet.kv_namespaces]]
binding = "MONITOR"
id = "56bc1fc46c3747978227b19d89d38b41"

[[env.testnet.kv_namespaces]]
binding = "CREDITS"
id = "9e0b1010e004441eb1d242a355235ed1"

[[env.testnet.durable_objects.bindings]]
name = "MONITOR_SCHEDULER"
class_name = "MonitorScheduler"

[env.testnet.vars]
# Use Base Sepolia testnet
NETWORK = "base-sepolia"
# Payment receiving address (use same or different for testing)
PAY_TO_ADDRESS = "0x1369f9899B0Eb899336A196003c86262997e7567"

[env.testnet.browser]
binding = "BROWSER"

[env.testnet.observability]
enabled = true
